<VirtualHost *:80>
        Define server_name  web.local
        Define appRoot      /var/www
        Define docRoot      ${appRoot}/public
        Define indexPrefix  index
        Define logdir       /var/log/apache2/

        ServerName ${server_name}

        <FilesMatch \.php$>
         SetHandler "proxy:fcgi://php-fpm:9000"
        </FilesMatch>

        DocumentRoot ${docRoot}

        <Directory ${docRoot}>
            AllowOverride All
            Require all granted
            DirectoryIndex ${indexPrefix}.php
            <IfModule mod_negotiation.c>
                Options -MultiViews
            </IfModule>

            <IfModule mod_rewrite.c>
                RewriteEngine On

                RewriteCond %{REQUEST_URI}::$0 ^(/.+)/(.*)::\2$
                RewriteRule .* - [E=BASE:%1]

                RewriteCond %{HTTP:Authorization} .+
                RewriteRule ^ - [E=HTTP_AUTHORIZATION:%0]

                RewriteCond %{ENV:REDIRECT_STATUS} =""
                RewriteRule ^${indexPrefix}\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]

                RewriteCond %{REQUEST_FILENAME} !-f
                RewriteRule ^ %{ENV:BASE}/${indexPrefix}.php [L]
            </IfModule>

            <IfModule !mod_rewrite.c>
                <IfModule mod_alias.c>
                    RedirectMatch 302 ^/$ /${indexPrefix}.php/
                </IfModule>
            </IfModule>
        </Directory>

        <Directory ${appRoot}/var>
            <IfModule mod_authz_core.c>
                Require all denied
            </IfModule>
            <IfModule !mod_authz_core.c>
                Order deny,allow
                Deny from all
            </IfModule>
        </Directory>

        ErrorLog ${logdir}/error.log
        CustomLog ${logdir}/access.log Combined

        Undefine server_name
        Undefine appRoot
        Undefine docRoot
        Undefine logdir
</VirtualHost>